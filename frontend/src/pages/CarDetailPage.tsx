import { useMutation, useQuery } from '@tanstack/react-query'; import { useParams } from 'react-router-dom'; import { api } from '../api/client'; import { Button, Input } from '../components/UI'; import { useForm } from 'react-hook-form'; import toast from 'react-hot-toast';
export default function CarDetailPage(){ const {id=''}=useParams(); const {data:car}=useQuery({queryKey:['car',id],queryFn:async()=> (await api.get('/cars/'+id)).data}); const {data:extras=[]}=useQuery({queryKey:['extras'],queryFn:async()=> (await api.get('/extras')).data}); const {register,handleSubmit}=useForm<any>(); const m=useMutation({mutationFn:(v:any)=>api.post('/reservations',v),onSuccess:()=>toast.success('Reservation submitted'),onError:()=>toast.error('Failed')}); if(!car) return <p>Loading...</p>; return <div className='grid md:grid-cols-2 gap-4'><div><img src={car.images?.[0]} className='w-full rounded'/><h1 className='text-2xl'>{car.brand} {car.model}</h1><p>{car.description}</p></div><form onSubmit={handleSubmit(v=>m.mutate({...v,carId:id,extraIds:Object.entries(v).filter(([k,val])=>k.startsWith('ex_')&&val).map(([k])=>k.replace('ex_',''))}))} className='space-y-2 bg-white p-3 rounded'><h2>Reserve</h2><Input type='date' {...register('startDate')} /><Input type='date' {...register('endDate')} /><Input placeholder='Pickup location' {...register('pickupLocation')} /><Input placeholder='Dropoff location' {...register('dropoffLocation')} /><Input placeholder='Notes' {...register('notes')} />{extras.map((e:any)=><label key={e.id} className='block'><input type='checkbox' {...register('ex_'+e.id)} /> {e.name} (+${e.pricePerDay}/day)</label>)}<Button>Submit</Button></form></div> }
