import { useMutation, useQuery, useQueryClient } from '@tanstack/react-query'; import { api } from '../api/client'; import { useForm } from 'react-hook-form'; import { Button, Input, Table } from '../components/UI';
export default function AdminCarsPage(){ const qc=useQueryClient(); const {data}=useQuery({queryKey:['cars-admin'],queryFn:async()=> (await api.get('/cars',{params:{limit:100}})).data}); const {register,handleSubmit,reset}=useForm<any>(); const create=useMutation({mutationFn:(v:any)=>api.post('/admin/cars',{...v,year:+v.year,seats:+v.seats,mileage:+v.mileage,dailyPrice:+v.dailyPrice,images:v.images.split(',')}),onSuccess:()=>{reset();qc.invalidateQueries({queryKey:['cars-admin']})}}); const del=useMutation({mutationFn:(id:string)=>api.delete('/admin/cars/'+id),onSuccess:()=>qc.invalidateQueries({queryKey:['cars-admin']})}); return <div className='space-y-3'><h1 className='text-xl'>Admin Cars</h1><form onSubmit={handleSubmit(v=>create.mutate(v))} className='grid grid-cols-2 md:grid-cols-4 gap-2 bg-white p-2 rounded'><Input placeholder='brand' {...register('brand')}/><Input placeholder='model' {...register('model')}/><Input placeholder='year' {...register('year')}/><Input placeholder='category' {...register('category')}/><Input placeholder='transmission' {...register('transmission')}/><Input placeholder='fuel' {...register('fuel')}/><Input placeholder='seats' {...register('seats')}/><Input placeholder='dailyPrice' {...register('dailyPrice')}/><Input placeholder='status' {...register('status')}/><Input placeholder='mileage' {...register('mileage')}/><Input placeholder='description' {...register('description')}/><Input placeholder='images comma urls' {...register('images')}/><Button>Create</Button></form><Table head={['Name','Year','Price','Status','']} rows={data?.items?.map((c:any)=><><td className='p-2'>{c.brand} {c.model}</td><td className='p-2'>{c.year}</td><td className='p-2'>{c.dailyPrice}</td><td className='p-2'>{c.status}</td><td className='p-2'><button onClick={()=>del.mutate(c.id)}>Delete</button></td></> )||[]} /></div> }
